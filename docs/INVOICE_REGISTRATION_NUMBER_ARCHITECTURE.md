# é›»å­å¸³ç°¿ä¿å­˜æ³•å¯¾å¿œ - é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

é›»å­å¸³ç°¿ä¿å­˜æ³•ï¼ˆã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦ï¼‰ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ã®ç™»éŒ²ç•ªå·ï¼ˆT+13æ¡ï¼‰ã‚’ã‚·ã‚¹ãƒ†ãƒ ã«çµ„ã¿è¾¼ã‚€åŒ…æ‹¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **å®Ÿè£…å®Œäº†ãƒ»æœ¬ç•ªç’°å¢ƒå¯¾å¿œ**
**ä½œæˆæ—¥**: 2025-11-16
**æœ€çµ‚æ›´æ–°**: 2025-11-17
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0 - å®Ÿè£…å®Œäº†ç‰ˆ

---

## ğŸ¯ èƒŒæ™¯ã¨ç›®çš„

### é›»å­å¸³ç°¿ä¿å­˜æ³•ã¨ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦

**ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦ï¼ˆé©æ ¼è«‹æ±‚æ›¸ç­‰ä¿å­˜æ–¹å¼ï¼‰**:
- 2023å¹´10æœˆ1æ—¥ã‹ã‚‰é–‹å§‹ã•ã‚ŒãŸæ¶ˆè²»ç¨ã®ä»•å…¥ç¨é¡æ§é™¤ã®æ–¹å¼
- é©æ ¼è«‹æ±‚æ›¸ï¼ˆã‚¤ãƒ³ãƒœã‚¤ã‚¹ï¼‰ã®ç™ºè¡Œãƒ»ä¿å­˜ãŒç¾©å‹™åŒ–
- é©æ ¼è«‹æ±‚æ›¸ã«ã¯ã€Œç™»éŒ²ç•ªå·ã€ã®è¨˜è¼‰ãŒå¿…é ˆ

**é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·**:
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: **T + 13æ¡ã®æ•°å­—**
- ä¾‹: `T1234567890123`
- äº‹æ¥­è€…ãŒç¨å‹™ç½²ã«ç™»éŒ²ç”³è«‹ã—ã€ä»˜ä¸ã•ã‚Œã‚‹å›ºæœ‰ç•ªå·
- è«‹æ±‚æ›¸ã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã§ã€è²·ã„æ‰‹å´ãŒä»•å…¥ç¨é¡æ§é™¤ã‚’å—ã‘ã‚‰ã‚Œã‚‹

### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ä»¥ä¸‹ã®2ã¤ã®ã‚·ãƒŠãƒªã‚ªã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

1. **è‡ªç¤¾ç™ºè¡Œã®è«‹æ±‚æ›¸**: è‡ªç¤¾ã®ç™»éŒ²ç•ªå·ã‚’PDFã«å°åˆ·
2. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè«‹æ±‚æ›¸**: ç›¸æ‰‹ä¼æ¥­ã®ç™»éŒ²ç•ªå·ã‚’OCRã§æŠ½å‡ºãƒ»ä¿å­˜

---

## ğŸ—ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

### 1. CompanySettingså‹ã®æ‹¡å¼µï¼ˆè‡ªç¤¾ã®ç™»éŒ²ç•ªå·ï¼‰

**å¤‰æ›´ç®‡æ‰€**: [`lib/types.ts:118`](lib/types.ts:118)

**Before:**
```typescript
export interface CompanySettings {
  name: string
  address: string
  phone: string
  email: string
  bankName: string
  branchName: string
  accountType: "æ™®é€šé é‡‘" | "å½“åº§é é‡‘"
  accountNumber: string
  taxRate: number
}
```

**After:**
```typescript
export interface CompanySettings {
  name: string
  address: string
  phone: string
  email: string
  bankName: string
  branchName: string
  accountType: "æ™®é€šé é‡‘" | "å½“åº§é é‡‘"
  accountNumber: string
  taxRate: number
  // ğŸ†• é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·
  registrationNumber?: string  // T + 13æ¡ (ä¾‹: T1234567890123)
}
```

**è¨­è¨ˆåˆ¤æ–­**:
- ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(`?`)ã«ã™ã‚‹ã“ã¨ã§ã€ç™»éŒ²ç•ªå·ã‚’æŒãŸãªã„äº‹æ¥­è€…ï¼ˆå…ç¨äº‹æ¥­è€…ç­‰ï¼‰ã«ã‚‚å¯¾å¿œ
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§ã‚’ç¶­æŒ

### 2. IssuerInfoå‹ã®æ´»ç”¨ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆç›¸æ‰‹ä¼æ¥­ã®ç™»éŒ²ç•ªå·ï¼‰

**æ—¢å­˜è¨­è¨ˆ**: [`docs/INVOICE_ISSUER_INFO_ARCHITECTURE.md`](docs/INVOICE_ISSUER_INFO_ARCHITECTURE.md:84)

æ—¢å­˜ã®`IssuerInfo`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã¯ã™ã§ã«`registrationNumber`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™:

```typescript
export interface IssuerInfo {
  name: string
  address?: string
  postalCode?: string
  phone?: string
  email?: string
  
  // ğŸ” æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆæ´»ç”¨ï¼‰
  registrationNumber?: string  // é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·
  
  contactPerson?: string
  department?: string
  website?: string
  fax?: string
  confidence?: number
}
```

**è¨­è¨ˆåˆ¤æ–­**:
- æ—¢å­˜ã®`IssuerInfo.registrationNumber`ã‚’æ´»ç”¨
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè«‹æ±‚æ›¸ã®ç™ºè¡Œå…ƒä¼æ¥­ã®ç™»éŒ²ç•ªå·ã‚’ä¿å­˜
- OCRå‡¦ç†ã§æŠ½å‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´

### 3. OCRResultå‹ã®æ‹¡å¼µ

**å¤‰æ›´ç®‡æ‰€**: [`lib/types.ts:66`](lib/types.ts:66)

**æ—¢å­˜è¨­è¨ˆç¢ºèª**:

æ—¢å­˜ã®`OCRResult`ã«ã‚‚`extractedFields.issuerRegistrationNumber`ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼ˆ[`docs/INVOICE_ISSUER_INFO_ARCHITECTURE.md:142`](docs/INVOICE_ISSUER_INFO_ARCHITECTURE.md:142)ï¼‰:

```typescript
export interface OCRResult {
  confidence: number
  processingTime: number
  extractedFields: {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    
    // ğŸ” æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆæ´»ç”¨ï¼‰
    issuerRegistrationNumber?: FieldExtraction  // ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™»éŒ²ç•ªå·
    
    // ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    invoiceNumber?: FieldExtraction
    clientName?: FieldExtraction
    // ...
  }
}
```

**è¨­è¨ˆåˆ¤æ–­**:
- æ—¢å­˜ã®`issuerRegistrationNumber`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ´»ç”¨
- æ–°è¦è¿½åŠ ã¯ä¸è¦

---

## ğŸ” ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

### ç™»éŒ²ç•ªå·ã®å½¢å¼ãƒã‚§ãƒƒã‚¯

**æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```typescript
const REGISTRATION_NUMBER_PATTERN = /^T\d{13}$/
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°** âœ… **å®Ÿè£…æ¸ˆã¿** - [`lib/api.ts:196`](lib/api.ts:196):
```typescript
/**
 * é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
 * @param value ç™»éŒ²ç•ªå·ï¼ˆT + 13æ¡ã®æ•°å­—ï¼‰
 * @returns ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
 */
export function validateRegistrationNumber(
  value: string
): { valid: boolean; error?: string } {
  // ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆåŒ–ï¼‰
  if (!value || value.trim() === '') {
    return {
      valid: false,
      error: 'ç™»éŒ²ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
    }
  }
  
  const trimmed = value.trim()
  
  // å½¢å¼ãƒã‚§ãƒƒã‚¯: T + 13æ¡
  if (!/^T\d{13}$/.test(trimmed)) {
    return {
      valid: false,
      error: 'ç™»éŒ²ç•ªå·ã¯T+13æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: T1234567890123ï¼‰'
    }
  }
  
  return { valid: true }
}
```

**é‡è¦ãªä»•æ§˜å¤‰æ›´**:
- âš ï¸ **ç™»éŒ²ç•ªå·ã¯å¿…é ˆé …ç›®** - ç©ºæ¬„ã§ã®ä¿å­˜ã¯ä¸å¯
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«åŸºã¥ãã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã‹ã‚‰å¿…é ˆã«å¤‰æ›´ï¼ˆ2025-11-17ï¼‰

**é©ç”¨ç®‡æ‰€**:
1. âœ… è¨­å®šç”»é¢ã§ã®å…¥åŠ›æ™‚ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
2. â³ OCRæŠ½å‡ºçµæœã®æ¤œè¨¼æ™‚ï¼ˆæœªå®Ÿè£…ï¼‰
3. â³ PDFç”Ÿæˆå‰ã®ãƒã‚§ãƒƒã‚¯ï¼ˆæœªå®Ÿè£…ï¼‰

---

## ğŸ’» å®Ÿè£…è¨­è¨ˆ

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°

#### 1.1 CompanySettingså‹ã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/types.ts:118`](lib/types.ts:118)

```typescript
export interface CompanySettings {
  name: string
  address: string
  phone: string
  email: string
  bankName: string
  branchName: string
  accountType: "æ™®é€šé é‡‘" | "å½“åº§é é‡‘"
  accountNumber: string
  taxRate: number
  registrationNumber?: string  // ğŸ†• è¿½åŠ 
}
```

#### 1.2 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/api.ts`](lib/api.ts:1)ï¼ˆã¾ãŸã¯æ–°è¦ `lib/validation.ts`ï¼‰

```typescript
/**
 * é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 */
export function validateRegistrationNumber(
  registrationNumber: string
): { valid: boolean; error?: string } {
  if (!registrationNumber || registrationNumber.trim() === '') {
    return { valid: true }
  }
  
  const trimmed = registrationNumber.trim()
  
  if (!/^T\d{13}$/.test(trimmed)) {
    return {
      valid: false,
      error: 'ç™»éŒ²ç•ªå·ã¯T+13æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: T1234567890123ï¼‰'
    }
  }
  
  return { valid: true }
}
```

### Phase 2: è¨­å®šç”»é¢ã®æ›´æ–°

#### 2.1 è¨­å®šç”»é¢UIã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`components/settings-enhanced.tsx`](components/settings-enhanced.tsx:1)

**è¿½åŠ å†…å®¹**:

1. **stateã®è¿½åŠ **ï¼ˆ27è¡Œç›®ä»˜è¿‘ï¼‰:
```typescript
const [registrationNumber, setRegistrationNumber] = useState(
  settings.company.registrationNumber || ''
)
```

2. **ä¿å­˜å‡¦ç†ã®æ›´æ–°**ï¼ˆ28-48è¡Œç›®ã®`handleSave`é–¢æ•°ï¼‰:
```typescript
const handleSave = () => {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validation = validateRegistrationNumber(registrationNumber)
  if (!validation.valid) {
    alert(validation.error)
    return
  }
  
  const updatedSettings: Settings = {
    company: {
      name: companyName,
      address: address,
      phone: phone,
      email: email,
      bankName: bankName,
      branchName: branchName,
      accountType: accountType,
      accountNumber: accountNumber,
      taxRate: settings.company.taxRate,
      registrationNumber: registrationNumber || undefined,  // ğŸ†• è¿½åŠ 
    },
    notifications: {
      dueDateReminder: dueDateReminder,
      paymentConfirmation: paymentConfirmation,
      invoiceCreation: invoiceCreation,
    },
  }
  updateSettings(updatedSettings)
  alert("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")
}
```

3. **UIãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ **ï¼ˆä¼æ¥­æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã€105è¡Œç›®ä»˜è¿‘ï¼‰:
```tsx
{/* ä¼æ¥­æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
<div className="bg-card border border-border rounded-lg p-6">
  <h3 className="text-lg font-semibold text-foreground mb-4">ä¼æ¥­æƒ…å ±</h3>
  <div className="space-y-4">
    {/* æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
    
    {/* ğŸ†• ç™»éŒ²ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
    <div>
      <label className="block text-sm font-medium text-foreground mb-2">
        é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·
        <span className="text-xs text-muted-foreground ml-2">
          ï¼ˆä»»æ„: T+13æ¡ã®æ•°å­—ï¼‰
        </span>
      </label>
      <input
        type="text"
        value={registrationNumber}
        onChange={(e) => setRegistrationNumber(e.target.value)}
        placeholder="T1234567890123"
        className="w-full px-4 py-2 border border-border rounded-lg bg-input text-foreground focus:outline-none focus:ring-2 focus:ring-primary"
      />
      <p className="text-xs text-muted-foreground mt-1">
        ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦å¯¾å¿œã€‚ç™»éŒ²ç•ªå·ã¯è«‹æ±‚æ›¸PDFã«è‡ªå‹•å°åˆ·ã•ã‚Œã¾ã™ã€‚
      </p>
    </div>
  </div>
</div>
```

### Phase 3: ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°

#### 3.1 mockSettingsã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/mock-data.ts:244`](lib/mock-data.ts:244)

```typescript
export const mockSettings: Settings = {
  company: {
    name: "v0 Inc.",
    address: "æ±äº¬éƒ½æ¸‹è°·åŒº",
    phone: "03-0000-0000",
    email: "info@v0.inc",
    bankName: "â—¯â—¯éŠ€è¡Œ",
    branchName: "â—¯â—¯æ”¯åº—",
    accountType: "æ™®é€šé é‡‘",
    accountNumber: "1234567890",
    taxRate: 0.1,
    registrationNumber: "T1234567890123",  // ğŸ†• è¿½åŠ ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
  },
  notifications: {
    dueDateReminder: true,
    paymentConfirmation: true,
    invoiceCreation: false,
  },
}
```

### Phase 4: PDFç”Ÿæˆæ©Ÿèƒ½ã®æ›´æ–°

#### 4.1 PDFç”Ÿæˆã§ã®ç™»éŒ²ç•ªå·è¡¨ç¤º

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/pdf-generator-japanese.tsx`](lib/pdf-generator-japanese.tsx:1)

**å¤‰æ›´ç®‡æ‰€**: ç™ºè¡Œè€…æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³

**ç¾åœ¨ã®å®Ÿè£…ç¢ºèªãŒå¿…è¦** - ä»¥ä¸‹ã¯æƒ³å®šã•ã‚Œã‚‹è¿½åŠ ç®‡æ‰€:

```tsx
{/* ç™ºè¡Œè€…æƒ…å ± */}
<View style={styles.section}>
  <Text style={styles.label}>ç™ºè¡Œè€…</Text>
  <Text style={styles.companyName}>{companyInfo.name}</Text>
  
  {/* ğŸ†• ç™»éŒ²ç•ªå·ã®è¡¨ç¤º */}
  {companyInfo.registrationNumber && (
    <Text style={styles.registrationNumber}>
      ç™»éŒ²ç•ªå·: {companyInfo.registrationNumber}
    </Text>
  )}
  
  <Text style={styles.text}>{companyInfo.address}</Text>
  <Text style={styles.text}>{companyInfo.email}</Text>
  <Text style={styles.text}>{companyInfo.phone}</Text>
</View>
```

**ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ **:
```tsx
const styles = StyleSheet.create({
  // ... æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«
  
  registrationNumber: {
    fontSize: 9,
    color: '#666',
    marginTop: 4,
    marginBottom: 4,
  },
})
```

#### 4.2 ä»–ã®PDFç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŒæ§˜ã«æ›´æ–°ãŒå¿…è¦:
- [`lib/pdf-generator-v6.ts`](lib/pdf-generator-v6.ts:1)
- ãã®ä»–ã®PDFç”Ÿæˆãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### Phase 5: OCRå‡¦ç†ã®å®Ÿè£…

#### 5.1 ç™»éŒ²ç•ªå·æŠ½å‡ºãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/ocr-processor.ts`](lib/ocr-processor.ts:139)

æ—¢å­˜ã®`parseInvoiceFields`ãƒ¡ã‚½ãƒƒãƒ‰ã«ç™»éŒ²ç•ªå·æŠ½å‡ºå‡¦ç†ã‚’è¿½åŠ :

```typescript
private parseInvoiceFields(text: string): OCRResult["extractedFields"] {
  // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰
  
  // ğŸ†• é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ã®æŠ½å‡º
  const registrationNumber = this.extractRegistrationNumber(text)
  if (registrationNumber) {
    fields.issuerRegistrationNumber = registrationNumber
  }
  
  // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰
  return fields
}

/**
 * é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ã®æŠ½å‡º
 * 
 * ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: T + 13æ¡ã®æ•°å­—
 * ä¾‹: T1234567890123
 */
private extractRegistrationNumber(text: string): FieldExtraction | undefined {
  // ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ©ãƒ™ãƒ«ä»˜ãï¼ˆæœ€ã‚‚ä¿¡é ¼åº¦ãŒé«˜ã„ï¼‰
  const labeledPatterns = [
    /(?:é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·|ç™»éŒ²ç•ªå·|ç™»éŒ²No|ç™»éŒ²ãƒŠãƒ³ãƒãƒ¼|Registration Number|Reg\.?\s*No\.?)[:\sï¼š]*\n?\s*(T\d{13})/i,
    /(?:ã‚¤ãƒ³ãƒœã‚¤ã‚¹|Invoice)[:\sï¼š]*\n?\s*(T\d{13})/i,
  ]
  
  for (const pattern of labeledPatterns) {
    const match = text.match(pattern)
    if (match) {
      return {
        value: match[1],
        confidence: 0.95,
      }
    }
  }
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ©ãƒ™ãƒ«ãªã—ã§T + 13æ¡ã‚’æ¤œå‡º
  const unlabeledPattern = /\b(T\d{13})\b/
  const unlabeledMatch = text.match(unlabeledPattern)
  
  if (unlabeledMatch) {
    return {
      value: unlabeledMatch[1],
      confidence: 0.7,
    }
  }
  
  return undefined
}
```

#### 5.2 OCRæŠ½å‡ºæ™‚ã®æ³¨æ„äº‹é …

**æ½œåœ¨çš„ãªå•é¡Œ**:
1. **OCRèª¤èªè­˜**: `T`ãŒ`I`ã‚„`1`ã¨èª¤èªè­˜ã•ã‚Œã‚‹å¯èƒ½æ€§
2. **ã‚¹ãƒšãƒ¼ã‚¹æ··å…¥**: `T 1234567890123`ã®ã‚ˆã†ã«ç©ºç™½ãŒå…¥ã‚‹å¯èƒ½æ€§
3. **é¡ä¼¼ãƒ‘ã‚¿ãƒ¼ãƒ³**: ä»–ã®13æ¡ã®æ•°å­—ã‚’èª¤æŠ½å‡ºã™ã‚‹å¯èƒ½æ€§

**å¯¾ç­–**:
```typescript
/**
 * ç™»éŒ²ç•ªå·ã®æ­£è¦åŒ–
 * OCRèª¤èªè­˜ã‚’è£œæ­£
 */
private normalizeRegistrationNumber(value: string): string {
  // ç©ºç™½ã‚’é™¤å»
  let normalized = value.replace(/\s+/g, '')
  
  // å…ˆé ­ã®I, 1, l ã‚’ T ã«å¤‰æ›ï¼ˆOCRèª¤èªè­˜å¯¾ç­–ï¼‰
  if (/^[Il1]\d{13}$/.test(normalized)) {
    normalized = 'T' + normalized.substring(1)
  }
  
  return normalized
}
```

### Phase 6: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã®æ›´æ–°

#### 6.1 buildIssuerInfoã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`lib/invoice-import-service.ts`](lib/invoice-import-service.ts:1)

æ—¢å­˜ã®`buildIssuerInfo`ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæœªå®Ÿè£…ã®å ´åˆã¯æ–°è¦ä½œæˆï¼‰:

```typescript
/**
 * OCRçµæœã‹ã‚‰ç™ºè¡Œå…ƒæƒ…å ±ã‚’æ§‹ç¯‰
 */
private buildIssuerInfo(
  extractedFields: OCRResult["extractedFields"]
): IssuerInfo | undefined {
  // ä¼æ¥­åãŒæŠ½å‡ºã•ã‚Œã¦ã„ãªã„å ´åˆã¯undefined
  if (!extractedFields.issuerName) {
    return undefined
  }
  
  const issuerInfo: IssuerInfo = {
    name: extractedFields.issuerName.value,
    address: extractedFields.issuerAddress?.value,
    postalCode: extractedFields.issuerPostalCode?.value,
    phone: extractedFields.issuerPhone?.value,
    email: extractedFields.issuerEmail?.value,
    registrationNumber: extractedFields.issuerRegistrationNumber?.value,  // ğŸ†• è¿½åŠ 
  }
  
  // ä¿¡é ¼åº¦ã‚’è¨ˆç®—
  issuerInfo.confidence = this.calculateIssuerConfidence(issuerInfo)
  
  // ä¿¡é ¼åº¦ãŒä½ã™ãã‚‹å ´åˆ(< 0.3)ã¯undefinedã‚’è¿”ã™
  if (issuerInfo.confidence < 0.3) {
    console.warn('ç™ºè¡Œå…ƒæƒ…å ±ã®ä¿¡é ¼åº¦ãŒä½ã„ãŸã‚ç ´æ£„ã—ã¾ã™:', issuerInfo)
    return undefined
  }
  
  return issuerInfo
}
```

#### 6.2 ä¿¡é ¼åº¦è¨ˆç®—ã®æ›´æ–°

ç™»éŒ²ç•ªå·ã‚’ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã«å«ã‚ã‚‹:

```typescript
/**
 * ç™ºè¡Œå…ƒæƒ…å ±ã®ä¿¡é ¼åº¦ã‚’ç®—å‡º
 */
private calculateIssuerConfidence(issuerInfo: IssuerInfo): number {
  let score = 0
  let maxScore = 0
  
  // ä¼æ¥­å(å¿…é ˆã€é…ç‚¹: 35%)
  if (issuerInfo.name) {
    score += 0.35
  }
  maxScore += 0.35
  
  // ä½æ‰€(é…ç‚¹: 20%)
  if (issuerInfo.address) {
    score += 0.20
  }
  maxScore += 0.20
  
  // é›»è©±ç•ªå·(é…ç‚¹: 15%)
  if (issuerInfo.phone) {
    score += 0.15
  }
  maxScore += 0.15
  
  // ğŸ†• ç™»éŒ²ç•ªå·(é…ç‚¹: 30%) - ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦ã§é‡è¦åº¦ãŒé«˜ã„
  if (issuerInfo.registrationNumber) {
    score += 0.30
  }
  maxScore += 0.30
  
  return maxScore > 0 ? score / maxScore : 0
}
```

### Phase 7: UIè¡¨ç¤ºã®æ›´æ–°

#### 7.1 è«‹æ±‚æ›¸è©³ç´°ç”»é¢ã§ã®è¡¨ç¤º

**ãƒ•ã‚¡ã‚¤ãƒ«**: [`components/invoice-detail-enhanced.tsx`](components/invoice-detail-enhanced.tsx:1)

ç™ºè¡Œè€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ç•ªå·ã‚’è¡¨ç¤ºï¼ˆæ—¢å­˜ã®`IssuerInfo`è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã«çµ±åˆï¼‰:

```tsx
{/* ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã§ç™ºè¡Œå…ƒæƒ…å ±ãŒã‚ã‚‹å ´åˆ */}
{(invoice.source === "pdf_import" || invoice.source === "image_import") && invoice.issuerInfo ? (
  <div>
    <div className="bg-blue-50 p-2 rounded mb-2">
      <p className="text-xs text-blue-800">
        â€» ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè«‹æ±‚æ›¸ã®ç™ºè¡Œå…ƒ
        {invoice.issuerInfo.confidence && (
          <span className="ml-2">
            (ä¿¡é ¼åº¦: {(invoice.issuerInfo.confidence * 100).toFixed(0)}%)
          </span>
        )}
      </p>
    </div>
    <p className="font-semibold text-foreground">{invoice.issuerInfo.name}</p>
    
    {/* ğŸ†• ç™»éŒ²ç•ªå·ã®è¡¨ç¤º */}
    {invoice.issuerInfo.registrationNumber && (
      <p className="text-xs text-muted-foreground mt-1 font-mono">
        ç™»éŒ²ç•ªå·: {invoice.issuerInfo.registrationNumber}
      </p>
    )}
    
    {invoice.issuerInfo.postalCode && (
      <p className="text-sm text-muted-foreground">
        ã€’{invoice.issuerInfo.postalCode}
      </p>
    )}
    {/* ... ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
  </div>
) : (
  {/* æ‰‹å‹•ä½œæˆãƒ‡ãƒ¼ã‚¿ã®å ´åˆ */}
  <div>
    <p className="font-semibold text-foreground">{settings.company.name}</p>
    
    {/* ğŸ†• è‡ªç¤¾ç™»éŒ²ç•ªå·ã®è¡¨ç¤º */}
    {settings.company.registrationNumber && (
      <p className="text-xs text-muted-foreground mt-1 font-mono">
        ç™»éŒ²ç•ªå·: {settings.company.registrationNumber}
      </p>
    )}
    
    <p className="text-sm text-muted-foreground">{settings.company.address}</p>
    <p className="text-sm text-muted-foreground">{settings.company.email}</p>
  </div>
)}
```

---

## ğŸ“‹ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

### æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿

**å½±éŸ¿ãªã—**:
- `CompanySettings.registrationNumber`ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- æ—¢å­˜ã®è¨­å®šãƒ‡ãƒ¼ã‚¿ã¯`registrationNumber: undefined`ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
- UIãƒ»PDFç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã§ç™»éŒ²ç•ªå·ãŒãªã„å ´åˆã¯è¡¨ç¤ºã‚’ã‚¹ã‚­ãƒƒãƒ—

### ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.2
- v1.0: åŸºæœ¬çš„ãªè«‹æ±‚æ›¸æ©Ÿèƒ½
- v1.1: `IssuerInfo`è¿½åŠ ï¼ˆç™ºè¡Œå…ƒæƒ…å ±ï¼‰
- v1.2: `CompanySettings.registrationNumber`è¿½åŠ ï¼ˆè‡ªç¤¾ç™»éŒ²ç•ªå·ï¼‰

**äº’æ›æ€§**:
- æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã¯å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚ã‚‹ï¼ˆ`registrationNumber`ã‚’`undefined`ã¨ã—ã¦æ‰±ã†ï¼‰
- å¤ã„ã‚³ãƒ¼ãƒ‰ã‚‚æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã‚ã‚‹ï¼ˆ`registrationNumber`ã‚’ç„¡è¦–ï¼‰

### ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ‰‹é †

**æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®å¯¾å¿œ**:

1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¾Œã€è¨­å®šç”»é¢ã«ç™»éŒ²ç•ªå·å…¥åŠ›æ¬„ãŒè¡¨ç¤ºã•ã‚Œã‚‹
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»»æ„ã§ç™»éŒ²ç•ªå·ã‚’å…¥åŠ›
3. å…¥åŠ›ã—ãªã„å ´åˆã§ã‚‚æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã—

**æ¨å¥¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹**:
```
ã€é‡è¦ãªãŠçŸ¥ã‚‰ã›ã€‘ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦å¯¾å¿œ

é›»å­å¸³ç°¿ä¿å­˜æ³•ï¼ˆã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦ï¼‰ã«å¯¾å¿œã—ã¾ã—ãŸã€‚
é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ã®æ–¹ã¯ã€è¨­å®šç”»é¢ã‹ã‚‰ç™»éŒ²ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
ç™»éŒ²ç•ªå·ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€PDFè«‹æ±‚æ›¸ã«è‡ªå‹•ã§å°åˆ·ã•ã‚Œã¾ã™ã€‚

ç™»éŒ²ç•ªå·ã®å…¥åŠ›ã¯ä»»æ„ã§ã™ã€‚å…ç¨äº‹æ¥­è€…ã®æ–¹ã¯å…¥åŠ›ä¸è¦ã§ã™ã€‚
```

---

## ğŸ¨ UI/UXè¨­è¨ˆè©³ç´°

### è¨­å®šç”»é¢ã®è¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ç™»éŒ²ç•ªå·ã‚ã‚Š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼æ¥­æƒ…å ±                                â”‚
â”‚                                         â”‚
â”‚ ä¼æ¥­å                                  â”‚
â”‚ [v0 Inc.                             ] â”‚
â”‚                                         â”‚
â”‚ é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·            â”‚
â”‚ ï¼ˆä»»æ„: T+13æ¡ã®æ•°å­—ï¼‰                  â”‚
â”‚ [T1234567890123                      ] â”‚
â”‚ ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦å¯¾å¿œã€‚ç™»éŒ²ç•ªå·ã¯è«‹æ±‚æ›¸    â”‚
â”‚ PDFã«è‡ªå‹•å°åˆ·ã•ã‚Œã¾ã™ã€‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç™»éŒ²ç•ªå·ãªã—ï¼ˆå…ç¨äº‹æ¥­è€…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼æ¥­æƒ…å ±                                â”‚
â”‚                                         â”‚
â”‚ ä¼æ¥­å                                  â”‚
â”‚ [å€‹äººäº‹æ¥­ä¸» ç”°ä¸­å•†åº—                 ] â”‚
â”‚                                         â”‚
â”‚ é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·            â”‚
â”‚ ï¼ˆä»»æ„: T+13æ¡ã®æ•°å­—ï¼‰                  â”‚
â”‚ [                                     ] â”‚
â”‚ ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦å¯¾å¿œã€‚ç™»éŒ²ç•ªå·ã¯è«‹æ±‚æ›¸    â”‚
â”‚ PDFã«è‡ªå‹•å°åˆ·ã•ã‚Œã¾ã™ã€‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PDFè¡¨ç¤ºã®ä¾‹

#### è‡ªç¤¾ç™ºè¡Œã®è«‹æ±‚æ›¸PDF

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          è«‹æ±‚æ›¸                     â”‚
â”‚                                     â”‚
â”‚ ç™ºè¡Œè€…                              â”‚
â”‚ v0 Inc.                             â”‚
â”‚ ç™»éŒ²ç•ªå·: T1234567890123            â”‚
â”‚ æ±äº¬éƒ½æ¸‹è°·åŒº                        â”‚
â”‚ info@v0.inc                         â”‚
â”‚ 03-0000-0000                        â”‚
â”‚                                     â”‚
â”‚ è«‹æ±‚å…ˆ                              â”‚
â”‚ æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ« æ§˜                 â”‚
â”‚ ...                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè«‹æ±‚æ›¸ã®è©³ç´°ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™ºè¡Œè€…                              â”‚
â”‚ â€» ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè«‹æ±‚æ›¸ã®ç™ºè¡Œå…ƒ    â”‚
â”‚   (ä¿¡é ¼åº¦: 85%)                     â”‚
â”‚                                     â”‚
â”‚ æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹                  â”‚
â”‚ ç™»éŒ²ç•ªå·: T9876543210987            â”‚
â”‚ ã€’100-0001                          â”‚
â”‚ æ±äº¬éƒ½åƒä»£ç”°åŒºåƒä»£ç”°1-1-1           â”‚
â”‚ TEL: 03-1234-5678                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å˜ä½“ãƒ†ã‚¹ãƒˆ

#### 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('validateRegistrationNumber', () => {
  test('æ­£ã—ã„å½¢å¼ã®ç™»éŒ²ç•ªå·ã‚’å—ã‘å…¥ã‚Œã‚‹', () => {
    const result = validateRegistrationNumber('T1234567890123')
    expect(result.valid).toBe(true)
  })
  
  test('ç©ºæ–‡å­—ã‚’è¨±å¯ã™ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰', () => {
    const result = validateRegistrationNumber('')
    expect(result.valid).toBe(true)
  })
  
  test('TãŒãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼', () => {
    const result = validateRegistrationNumber('1234567890123')
    expect(result.valid).toBe(false)
    expect(result.error).toContain('T+13æ¡')
  })
  
  test('13æ¡ã§ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼', () => {
    const result = validateRegistrationNumber('T12345678901')
    expect(result.valid).toBe(false)
  })
  
  test('æ•°å­—ä»¥å¤–ã®æ–‡å­—ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼', () => {
    const result = validateRegistrationNumber('T123456789012A')
    expect(result.valid).toBe(false)
  })
})
```

#### 2. OCRæŠ½å‡ºã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('OCRProcessor - ç™»éŒ²ç•ªå·æŠ½å‡º', () => {
  test('ãƒ©ãƒ™ãƒ«ä»˜ãç™»éŒ²ç•ªå·ã‚’æ­£ã—ãæŠ½å‡ºã§ãã‚‹', () => {
    const text = `
é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·: T1234567890123
æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹
    `
    const result = ocrProcessor.parseInvoiceFields(text)
    expect(result.issuerRegistrationNumber?.value).toBe('T1234567890123')
    expect(result.issuerRegistrationNumber?.confidence).toBeGreaterThan(0.9)
  })
  
  test('ãƒ©ãƒ™ãƒ«ãªã—ç™»éŒ²ç•ªå·ã‚’æŠ½å‡ºã§ãã‚‹', () => {
    const text = `
æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹
T9876543210987
æ±äº¬éƒ½åƒä»£ç”°åŒº
    `
    const result = ocrProcessor.parseInvoiceFields(text)
    expect(result.issuerRegistrationNumber?.value).toBe('T9876543210987')
  })
  
  test('ç™»éŒ²ç•ªå·ãŒãªã„å ´åˆã¯undefined', () => {
    const text = `
æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹
æ±äº¬éƒ½åƒä»£ç”°åŒº
    `
    const result = ocrProcessor.parseInvoiceFields(text)
    expect(result.issuerRegistrationNumber).toBeUndefined()
  })
})
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

#### ã‚·ãƒŠãƒªã‚ª1: è‡ªç¤¾ç™»éŒ²ç•ªå·ã®è¨­å®šã¨PDFç”Ÿæˆ

```typescript
describe('çµ±åˆãƒ†ã‚¹ãƒˆ: è‡ªç¤¾ç™»éŒ²ç•ªå·', () => {
  test('è¨­å®šç”»é¢ã§ç™»éŒ²ç•ªå·ã‚’å…¥åŠ›ã—ã¦PDFç”Ÿæˆã§ãã‚‹', async () => {
    // 1. è¨­å®šã‚’æ›´æ–°
    const newSettings = {
      ...mockSettings,
      company: {
        ...mockSettings.company,
        registrationNumber: 'T1234567890123'
      }
    }
    updateSettings(newSettings)
    
    // 2. è«‹æ±‚æ›¸ã‚’ä½œæˆ
    const invoice = {
      ...mockInvoice,
      client: mockClients[0]
    }
    
    // 3. PDFç”Ÿæˆ
    const pdfBlob = await downloadInvoicePDFJapanese(invoice, newSettings.company)
    
    // 4. PDFã«ç™»éŒ²ç•ªå·ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¤œè¨¼
    expect(pdfBlob).toBeDefined()
    // PDFãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã—ã¦æ¤œè¨¼ï¼ˆå®Ÿè£…ã«å¿œã˜ã¦ï¼‰
  })
})
```

#### ã‚·ãƒŠãƒªã‚ª2: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®ç™»éŒ²ç•ªå·æŠ½å‡º

```typescript
describe('çµ±åˆãƒ†ã‚¹ãƒˆ: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‹ã‚‰ã®ç™»éŒ²ç•ªå·æŠ½å‡º', () => {
  test('ç™»éŒ²ç•ªå·ä»˜ãè«‹æ±‚æ›¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹', async () => {
    // ãƒ†ã‚¹ãƒˆç”¨PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    const testPDF = createTestInvoicePDF({
      issuer: {
        name: 'æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹',
        registrationNumber: 'T9876543210987',
        address: 'æ±äº¬éƒ½åƒä»£ç”°åŒºåƒä»£ç”°1-1-1',
      },
      total: 108000,
    })
    
    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ
    const result = await invoiceImportService.importFromFile(testPDF, [])
    
    // æ¤œè¨¼
    expect(result.invoice.issuerInfo?.registrationNumber).toBe('T9876543210987')
  })
})
```

### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ¤œè¨¼

| ã‚±ãƒ¼ã‚¹ | æœŸå¾…å‹•ä½œ | æ¤œè¨¼é …ç›® |
|--------|---------|----------|
| ç™»éŒ²ç•ªå·ãªã—ã§ä¿å­˜ | æ­£å¸¸ã«ä¿å­˜ã•ã‚Œã‚‹ | `registrationNumber`ãŒ`undefined` |
| ä¸æ­£ãªå½¢å¼ã§å…¥åŠ› | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| OCRã§èª¤èªè­˜ï¼ˆIä»£ã‚ã‚Šã«Tï¼‰ | æ­£è¦åŒ–ã§è£œæ­£ã•ã‚Œã‚‹ | `T`ã«å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ |
| è¤‡æ•°ã®ç™»éŒ²ç•ªå·ãŒè¨˜è¼‰ | æœ€åˆã®ã‚‚ã®ã‚’æŠ½å‡º | æ­£ã—ã„ç•ªå·ãŒæŠ½å‡ºã•ã‚Œã‚‹ |
| ã‚¹ãƒšãƒ¼ã‚¹æ··å…¥(`T 1234567890123`) | æ­£è¦åŒ–ã§é™¤å»ã•ã‚Œã‚‹ | ã‚¹ãƒšãƒ¼ã‚¹ãªã—ã§ä¿å­˜ |

---

## âš ï¸ æŠ€è¡“çš„èª²é¡Œã¨å¯¾ç­–

### 1. OCRç²¾åº¦ã®å•é¡Œ

**èª²é¡Œ**: ç™»éŒ²ç•ªå·ã®`T`ãŒ`I`ã‚„`1`ã¨èª¤èªè­˜ã•ã‚Œã‚‹å¯èƒ½æ€§

**å¯¾ç­–**:
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã§ã€Œç™»éŒ²ç•ªå·ã€ãƒ©ãƒ™ãƒ«ä»˜è¿‘ã‚’å„ªå…ˆ
- æ­£è¦åŒ–å‡¦ç†ã§`I`, `1`, `l`ã‚’`T`ã«è£œæ­£
- ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã‚’ä¿ƒã™
- æ‰‹å‹•è£œæ­£æ©Ÿèƒ½ã®æä¾›ï¼ˆå°†æ¥ã®æ‹¡å¼µï¼‰

### 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**èª²é¡Œ**: ã„ã¤ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã¹ãã‹

**å¯¾ç­–**:
- **å…¥åŠ›æ™‚**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆonBlurï¼‰
- **ä¿å­˜æ™‚**: å¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **PDFç”Ÿæˆæ™‚**: æœ€çµ‚ãƒã‚§ãƒƒã‚¯

### 3. å…ç¨äº‹æ¥­è€…ã¸ã®å¯¾å¿œ

**èª²é¡Œ**: ç™»éŒ²ç•ªå·ã‚’æŒãŸãªã„äº‹æ¥­è€…ã¸ã®é…æ…®

**å¯¾ç­–**:
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®Œå…¨ã«ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã«
- UIä¸Šã§ã€Œä»»æ„ã€ã¨æ˜è¨˜
- ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆã§èª¬æ˜ã‚’è¿½åŠ 
- ç™»éŒ²ç•ªå·ãªã—ã§ã‚‚ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹

### 4. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å°†æ¥çš„ãªå¤‰æ›´

**èª²é¡Œ**: åˆ¶åº¦æ”¹æ­£ã§å½¢å¼ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§

**å¯¾ç­–**:
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç‹¬ç«‹ã—ãŸé–¢æ•°ã«
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿å‹ã¯æŸ”è»Ÿã«ï¼ˆ`string`å‹ï¼‰

---

## ğŸ“Š å½±éŸ¿ç¯„å›²ã¾ã¨ã‚

### ãƒ‡ãƒ¼ã‚¿å±¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|--------|
| [`lib/types.ts:118`](lib/types.ts:118) | `CompanySettings`ã«`registrationNumber`è¿½åŠ  | ğŸ”´ é«˜ |
| [`lib/mock-data.ts:244`](lib/mock-data.ts:244) | `mockSettings`ã«ã‚µãƒ³ãƒ—ãƒ«ç™»éŒ²ç•ªå·è¿½åŠ  | ğŸŸ¡ ä¸­ |
| [`lib/api.ts`](lib/api.ts:1) | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°è¿½åŠ  | ğŸ”´ é«˜ |

### UIå±¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|--------|
| [`components/settings-enhanced.tsx`](components/settings-enhanced.tsx:1) | ç™»éŒ²ç•ªå·å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ  | ğŸ”´ é«˜ |
| [`components/invoice-detail-enhanced.tsx`](components/invoice-detail-enhanced.tsx:1) | ç™ºè¡Œè€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ç•ªå·è¡¨ç¤º | ğŸŸ¡ ä¸­ |

### OCRãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆå±¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|--------|
| [`lib/ocr-processor.ts:139`](lib/ocr-processor.ts:139) | ç™»éŒ²ç•ªå·æŠ½å‡ºãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ  | ğŸ”´ é«˜ |
| [`lib/invoice-import-service.ts`](lib/invoice-import-service.ts:1) | `buildIssuerInfo`ã«ç™»éŒ²ç•ªå·å‡¦ç†è¿½åŠ  | ğŸŸ¡ ä¸­ |

### PDFç”Ÿæˆå±¤

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|--------|
| [`lib/pdf-generator-japanese.tsx`](lib/pdf-generator-japanese.tsx:1) | ç™ºè¡Œè€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ç•ªå·è¡¨ç¤º | ğŸ”´ é«˜ |
| [`lib/pdf-generator-v6.ts`](lib/pdf-generator-v6.ts:1) | åŒä¸Šï¼ˆä½¿ç”¨ä¸­ã®å ´åˆï¼‰ | ğŸŸ¡ ä¸­ |

---

## ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« âœ… **å®Œäº†**

- [x] âœ… [`lib/types.ts:137`](lib/types.ts:137): `CompanySettings`ã«`registrationNumber?: string`ã‚’è¿½åŠ 
- [x] âœ… [`lib/api.ts:196`](lib/api.ts:196): `validateRegistrationNumber()`é–¢æ•°ã‚’å®Ÿè£…ï¼ˆå¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- [x] âœ… [`lib/mock-data.ts:244`](lib/mock-data.ts:244): `mockSettings`ã«ã‚µãƒ³ãƒ—ãƒ«ç™»éŒ²ç•ªå·ã‚’è¿½åŠ 

### Phase 2: è¨­å®šç”»é¢ âœ… **å®Œäº†**

- [x] âœ… [`components/settings-enhanced.tsx:29`](components/settings-enhanced.tsx:29): stateå¤‰æ•°`registrationNumber`ã‚’è¿½åŠ 
- [x] âœ… åŒä¸Š:139-166è¡Œç›®: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰UIã‚’è¿½åŠ ï¼ˆãƒ©ãƒ™ãƒ«ãƒ»ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆãƒ»ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼‰
- [x] âœ… åŒä¸Š:37-48è¡Œç›®: `handleSave`ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’è¿½åŠ ï¼ˆToasté€šçŸ¥çµ±åˆï¼‰
- [x] âœ… åŒä¸Š:32-35è¡Œç›®: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`onBlur`ï¼‰ã‚’å®Ÿè£…
- [x] âœ… [`app/layout.tsx:6,27`](app/layout.tsx:6): `<Toaster />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ 

### Phase 3: OCRå‡¦ç† â³ **æœªå®Ÿè£…**

- [ ] [`lib/ocr-processor.ts:139`](lib/ocr-processor.ts:139): `extractRegistrationNumber()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…
- [ ] åŒä¸Š: `parseInvoiceFields()`ã§ç™»éŒ²ç•ªå·æŠ½å‡ºã‚’å‘¼ã³å‡ºã—
- [ ] åŒä¸Š: æ­£è¦åŒ–å‡¦ç†ï¼ˆã‚¹ãƒšãƒ¼ã‚¹é™¤å»ã€Tè£œæ­£ï¼‰ã‚’å®Ÿè£…

### Phase 4: ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ â³ **æœªå®Ÿè£…**

- [ ] [`lib/invoice-import-service.ts`](lib/invoice-import-service.ts:1): `buildIssuerInfo()`ã§ç™»éŒ²ç•ªå·ã‚’å‡¦ç†
- [ ] åŒä¸Š: `calculateIssuerConfidence()`ã«ç™»éŒ²ç•ªå·ã®é…ç‚¹ã‚’è¿½åŠ 

### Phase 5: PDFç”Ÿæˆ âœ… **å®Œäº†**

- [x] âœ… [`lib/pdf-generator-japanese.tsx:186-190`](lib/pdf-generator-japanese.tsx:186): ç™ºè¡Œè€…æƒ…å ±ã«ç™»éŒ²ç•ªå·ã‚’è¡¨ç¤º
- [x] âœ… åŒä¸Š:79-84è¡Œç›®: ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã‚’è¿½åŠ ï¼ˆ`registrationNumber`ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
- [ ] [`lib/pdf-generator-v6.ts`](lib/pdf-generator-v6.ts:1): åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### Phase 6: UIè¡¨ç¤º â³ **æœªå®Ÿè£…**

- [ ] [`components/invoice-detail-enhanced.tsx`](components/invoice-detail-enhanced.tsx:1): ã‚¤ãƒ³ãƒãƒ¼ãƒˆè«‹æ±‚æ›¸ã®ç™ºè¡Œå…ƒã«ç™»éŒ²ç•ªå·è¡¨ç¤º
- [ ] åŒä¸Š: æ‰‹å‹•ä½œæˆè«‹æ±‚æ›¸ã®ç™ºè¡Œè€…ã«ç™»éŒ²ç•ªå·è¡¨ç¤º

### Phase 7: ãƒ†ã‚¹ãƒˆ â³ **æœªå®Ÿè£…**

- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] OCRæŠ½å‡ºã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
- [x] âœ… è¨­å®šç”»é¢ã®çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆæ‰‹å‹•ç¢ºèªå®Œäº†ï¼‰
- [x] âœ… PDFç”Ÿæˆã®çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆæ‰‹å‹•ç¢ºèªå®Œäº†ï¼‰
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ¤œè¨¼

---

## ğŸš€ å®Ÿè£…ã®å„ªå…ˆé †ä½

### ç¬¬1å„ªå…ˆï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰

1. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ** - `CompanySettings`ã«`registrationNumber`è¿½åŠ 
2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°** - å½¢å¼ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
3. **è¨­å®šç”»é¢UI** - ç™»éŒ²ç•ªå·å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

### ç¬¬2å„ªå…ˆï¼ˆè‡ªç¤¾ç™ºè¡Œè«‹æ±‚æ›¸å¯¾å¿œï¼‰

4. **PDFç”Ÿæˆ** - è‡ªç¤¾ç™»éŒ²ç•ªå·ã®å°åˆ·
5. **è©³ç´°ç”»é¢è¡¨ç¤º** - æ‰‹å‹•ä½œæˆè«‹æ±‚æ›¸ã§ã®ç™»éŒ²ç•ªå·è¡¨ç¤º

### ç¬¬3å„ªå…ˆï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯¾å¿œï¼‰

6. **OCRæŠ½å‡º** - ç™»éŒ²ç•ªå·ã®æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
7. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹** - `IssuerInfo`ã¸ã®ç™»éŒ²ç•ªå·è¨­å®š
8. **è©³ç´°ç”»é¢è¡¨ç¤º** - ã‚¤ãƒ³ãƒãƒ¼ãƒˆè«‹æ±‚æ›¸ã§ã®ç™»éŒ²ç•ªå·è¡¨ç¤º

### ç¬¬4å„ªå…ˆï¼ˆå“è³ªå‘ä¸Šï¼‰

9. **ãƒ†ã‚¹ãƒˆä½œæˆ** - å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
10. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ
11. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ä½œæˆ

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è«‹æ±‚æ›¸ç™ºè¡Œå…ƒæƒ…å ±ç®¡ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸](INVOICE_ISSUER_INFO_ARCHITECTURE.md)
  - `IssuerInfo`å‹ã®è©³ç´°è¨­è¨ˆ
  - OCRç™ºè¡Œå…ƒæŠ½å‡ºã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- [è«‹æ±‚æ›¸èª­ã¿è¾¼ã¿æ©Ÿèƒ½ - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸](INVOICE_IMPORT_ARCHITECTURE.md)
  - OCRå‡¦ç†å…¨èˆ¬ã®è¨­è¨ˆ
- [PDFç”Ÿæˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - æ—¥æœ¬èªå¯¾å¿œã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³](PDF_ARCHITECTURE.md)
  - PDFç”Ÿæˆã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

---

## ğŸ‰ æœŸå¾…ã•ã‚Œã‚‹æˆæœ

### ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤

1. âœ… **é›»å­å¸³ç°¿ä¿å­˜æ³•ã¸ã®å®Œå…¨å¯¾å¿œ**
   - ã‚¤ãƒ³ãƒœã‚¤ã‚¹åˆ¶åº¦ã«æº–æ‹ ã—ãŸè«‹æ±‚æ›¸ç™ºè¡Œ
   - æ³•çš„è¦ä»¶ã‚’æº€ãŸã—ãŸPDFç”Ÿæˆ

2. âœ… **æ¥­å‹™åŠ¹ç‡åŒ–**
   - è‡ªç¤¾ç™»éŒ²ç•ªå·ã®è‡ªå‹•å°åˆ·
   - ã‚¤ãƒ³ãƒãƒ¼ãƒˆè«‹æ±‚æ›¸ã‹ã‚‰ã®ç™»éŒ²ç•ªå·è‡ªå‹•æŠ½å‡º

3. âœ… **ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®å‘ä¸Š**
   - å–å¼•å…ˆã®ç™»éŒ²ç•ªå·ã‚’è‡ªå‹•ä¿å­˜
   - é©æ ¼äº‹æ¥­è€…ã¨ã®å–å¼•å±¥æ­´ç®¡ç†

### æŠ€è¡“çš„æˆæœ

1. âœ… **æ‹¡å¼µæ€§ã®é«˜ã„è¨­è¨ˆ**
   - ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚ˆã‚‹æŸ”è»Ÿæ€§
   - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®å®Œå…¨äº’æ›æ€§

2. âœ… **å …ç‰¢ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
   - å½¢å¼ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å“è³ªä¿è¨¼
   - OCRèª¤èªè­˜ã¸ã®å¯¾å¿œ

3. âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š**
   - ç›´æ„Ÿçš„ãªè¨­å®šUI
   - æ˜ç¢ºãªãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ

---

## ğŸ‰ å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼ï¼ˆ2025-11-17ï¼‰

### âœ… å®Ÿè£…å®Œäº†é …ç›®

1. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ**
   - [`lib/types.ts:137`](lib/types.ts:137) - `CompanySettings.registrationNumber`è¿½åŠ æ¸ˆã¿

2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°**
   - [`lib/api.ts:196`](lib/api.ts:196) - å¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
   - å½¢å¼ãƒã‚§ãƒƒã‚¯: T + 13æ¡
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãæˆ»ã‚Šå€¤

3. **è¨­å®šç”»é¢UI**
   - [`components/settings-enhanced.tsx`](components/settings-enhanced.tsx:1) - å®Œå…¨ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`onBlur`ï¼‰
   - Toasté€šçŸ¥çµ±åˆï¼ˆ`useToast`ï¼‰
   - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼ˆARIAå±æ€§ï¼‰
   - ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºUIï¼ˆèµ¤æ ï¼‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

4. **PDFç”Ÿæˆçµ±åˆ**
   - [`lib/pdf-generator-japanese.tsx`](lib/pdf-generator-japanese.tsx:186) - ç™ºè¡Œè€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ç•ªå·è¡¨ç¤º
   - æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆç™»éŒ²ç•ªå·ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
   - å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©

5. **å‹•ä½œç¢ºèª**
   - è¨­å®šç”»é¢ã§ã®å…¥åŠ›ãƒ»ä¿å­˜
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
   - PDFã¸ã®å°åˆ·

### â³ æœªå®Ÿè£…é …ç›®ï¼ˆä»Šå¾Œã®æ‹¡å¼µï¼‰

1. **OCRå‡¦ç†** - ã‚¤ãƒ³ãƒãƒ¼ãƒˆè«‹æ±‚æ›¸ã‹ã‚‰ã®ç™»éŒ²ç•ªå·æŠ½å‡º
2. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹** - `IssuerInfo`ã¸ã®ç™»éŒ²ç•ªå·è¨­å®š
3. **è«‹æ±‚æ›¸è©³ç´°ç”»é¢** - ã‚¤ãƒ³ãƒãƒ¼ãƒˆè«‹æ±‚æ›¸ã§ã®ç™»éŒ²ç•ªå·è¡¨ç¤º
4. **è‡ªå‹•ãƒ†ã‚¹ãƒˆ** - å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»E2Eãƒ†ã‚¹ãƒˆ

### ğŸ“Š å®Ÿè£…å®Œäº†ç‡

- **Phase 1ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼‰**: 100% âœ…
- **Phase 2ï¼ˆè¨­å®šç”»é¢ï¼‰**: 100% âœ…
- **Phase 3ï¼ˆOCRå‡¦ç†ï¼‰**: 0% â³
- **Phase 4ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰**: 0% â³
- **Phase 5ï¼ˆPDFç”Ÿæˆï¼‰**: 100% âœ…
- **Phase 6ï¼ˆUIè¡¨ç¤ºï¼‰**: 0% â³
- **Phase 7ï¼ˆãƒ†ã‚¹ãƒˆï¼‰**: 30% ğŸŸ¡

**ç·åˆé€²æ—**: ç´„40% - **è‡ªç¤¾ç™ºè¡Œè«‹æ±‚æ›¸æ©Ÿèƒ½ã¯å®Œå…¨å‹•ä½œ**

---

**ä½œæˆè€…**: AI Architect
**å®Ÿè£…è€…**: AI Code Assistant
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªæ¸ˆã¿
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **å®Ÿè£…å®Œäº†ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1-2, 5ï¼‰**
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Phase 3ï¼ˆOCRå‡¦ç†ï¼‰ã®å®Ÿè£…é–‹å§‹ã€ã¾ãŸã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ